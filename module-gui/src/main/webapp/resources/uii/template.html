<!DOCTYPE html>
<html
    lang="#{SpracheForm.locale}"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:ds="http://deltaspike.apache.org/jsf">
<h:head>
    <meta charset="utf-8" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0" />
    <!-- Apple devices fullscreen -->
    <meta
        name="apple-mobile-web-app-capable"
        content="yes" />
    <!-- Apple devices fullscreen -->
    <meta
        name="apple-mobile-web-app-status-bar-style"
        content="black-translucent" />

    <meta
        name="description"
        content="Goobi workflow" />
    <meta
        name="author"
        content="intranda GmbH" />
    <meta
        http-equiv="Content-Type"
        content="text/html; charset=utf-8" />
    <meta
        http-equiv="Content-Script-Type"
        content="type" />
    <meta
        http-equiv="pragma"
        content="no-cache" />
    <meta
        http-equiv="cache-control"
        content="no-cache" />
    <meta
        name="date"
        content="1970-01-01T00:00:00+01:00" />
    <meta
        name="version"
        content="#{HelperForm.applicationHeaderTitle} - #{HelperForm.buildVersion}" />
    <meta
        name="builddate"
        content="#{HelperForm.buildDate}" />
    <title><h:outputText value="#{HelperForm.applicationHeaderTitle} - #{HelperForm.version}" /></title>

    <!-- Bootstrap -->
    <link
        rel="stylesheet"
        href="template/css/bootstrap.min.css?v=#{HelperForm.buildVersion}" />

    <link
        rel="stylesheet"
        href="template/css/bootstrap-slider.css?v=#{HelperForm.buildVersion}" />

    <!-- Theme CSS -->
    <link
        rel="stylesheet"
        href="template/css/style.css?v=#{HelperForm.buildVersion}" />

    <!-- Font Awesome CSS -->
    <link
        rel="stylesheet"
        href="template/css/font-awesome.css?v=#{HelperForm.buildVersion}" />
    <!-- Color CSS -->
    <link
        rel="stylesheet"
        href="template/css/themes.css?v=#{HelperForm.buildVersion}" />
    <!-- intranda -->
    <link
        rel="stylesheet"
        href="template/css/intranda.css?v=#{HelperForm.buildVersion}" />
    <!-- <link rel="stylesheet" href="template/css/dist/goobiWorkflow.min.css?v=#{HelperForm.buildVersion}" /> -->
	
    <link
        rel="stylesheet"
        href="plugin-workflow-entity-editor.css?v=#{HelperForm.buildVersion}" />

    <script src="template/js/intranda.js?v=1.2"></script>
    <!-- jQuery -->
    <h:outputScript
        library="primefaces"
        name="jquery/jquery.js?v=#{HelperForm.buildVersion}"
        target="head" />
    <!-- Mobile nav swipe -->
    <script src="template/js/plugins/touchwipe/touchwipe.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Nice Scroll -->
    <script src="template/js/plugins/nicescroll/jquery.nicescroll.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- imagesLoaded -->
    <script src="template/js/plugins/imagesLoaded/jquery.imagesloaded.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- jQuery UI -->
    <script src="template/js/plugins/jquery-ui/jquery-ui.js?v=#{HelperForm.buildVersion}"></script>
    <!-- slimScroll -->
    <script src="template/js/plugins/slimscroll/jquery.slimscroll.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootstrap -->
    <script src="template/js/bootstrap.min.js?v=#{HelperForm.buildVersion}"></script>
    <script src="template/js/bootstrap-slider.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootbox -->
    <script src="template/js/plugins/bootbox/jquery.bootbox.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootbox -->
    <script src="template/js/plugins/form/jquery.form.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Validation -->
    <script src="template/js/plugins/validation/jquery.validate.min.js?v=#{HelperForm.buildVersion}"></script>
    <script src="template/js/plugins/validation/additional-methods.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- shortcuts -->
    <script src="template/js/jquery.hotkeys.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Theme framework -->
    <!-- <script src="template/js/eakroko.js?v=#{HelperForm.buildVersion}"></script> -->
    <!-- Theme scripts -->
    <script src="template/js/application.js?v=#{HelperForm.buildVersion}"></script>

        <script
            type="text/javascript"
            src='template/js/plugins/tinymce/tinymce.min.js'></script>

    <!--[if lte IE 9]>
	<script src="template/js/plugins/placeholder/jquery.placeholder.min.js?v=#{HelperForm.buildVersion}"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->
    <!-- Favicon -->
    <link
        rel="shortcut icon"
        href="template/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link
        rel="apple-touch-icon-precomposed"
        href="template/img/apple-touch-icon.png" />

</h:head>


<h:body styleClass="sidebar-right">
    <ds:windowId />
    <f:view locale="#{SpracheForm.locale}">
        <nav
            role="navigation"
            aria-label="navigation"
            id="navigation"
            class="container-fluid">
            <ui:insert name="navigation" />


        </nav>



        <div
            class="container-fluid"
            style="padding-bottom: 20px">
            <div
                id="main"
                style="margin-right: 0px;">
                <div class="container-fluid">


                    <div role="complementary">
                        <h:panelGroup id="messages">
                            <h:messages
                                escape="false"
                                globalOnly="true"
                                errorClass="alert alert-danger"
                                infoClass="alert alert-info"
                                warnClass="alert"
                                showDetail="true"
                                showSummary="true"
                                tooltip="true"
                                styleClass="messages" />
                        </h:panelGroup>
                    </div>
                    <div>
                        <ui:insert name="content" />
                    </div>
                </div>
            </div>
        </div>


        <!-- JAVASCRIPT -->

        <!-- Reactive rx -->
         <script src="template/js/reactiveX/rx.lite.min.js"></script>

        <script src="template/js/dist/goobiWorkflowJS.min.js?v=#{HelperForm.buildVersion}"></script>
        <script>

            // goobiWorkflowConfig = {};

            // goobiWorkflowJS.init(goobiWorkflowConfig);

                                </script>
        <script>

     // <![CDATA[
         
         
            window.onload = function() {
                                                                        loadImages();
                                                                    }

                                                                    function loadThumbnails() {
                                                                        var height = 200;
                                                                        if ( height ) {
                                                                            $( '.goobi-thumbnail-image' ).css( 'height', ( height + 25 ) + 'px' );
                                                                            $( '.goobi-thumbnail-image .thumb' ).css( 'max-height', height + 'px' );
                                                                            $( '.goobi-thumbnail-image .thumb canvas' ).css( 'max-height', height + 'px' );
                                                                            $( '.goobi-thumbnail-image' ).css( 'max-width', ( height ) + 'px' );
                                                                        }
                                                                    }

                                                                    $( document ).ready( function() {
                                                                        loadThumbnails();
                                                                    } );
                                                                    
         
         
            jsf.ajax.addOnEvent(function (data) {
                var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
                var ajaxloader = document.getElementById("ajaxloader");
                var source = data.source;
                var noLoaderGif = source.type == "hidden" && source.id.indexOf("header") == 0;

                switch (ajaxstatus) {
                    case "begin": // This is called right before ajax request is been sent.
                    	if(ajaxloader && !noLoaderGif) {
                        	ajaxloader.style.display = 'block';
                    	}
                        break;

                    case "complete": // This is called right after ajax response is received.
                    	if(ajaxloader) {
                        	ajaxloader.style.display = 'none';
                    	}
                        break;

                    case "success": // This is called when ajax response is successfully processed.
                        // NOOP.
                        $(function () {
                            $('[data-toggle="tooltip"]').tooltip();
                            $('[data-toggle="popover"]').popover();
                            if ($('.popover.fade.right.in').length > 0) {
                                $('.popover.fade.right.in').remove();
                            }
                            scrollDownScrollDowns();
                        })
                        if (window.noLoadImages === undefined) {
                            loadImages();
                        }
                        break;
                }
            });

            $(document).ready(function () {
                $('[data-toggle="tooltip"]').tooltip();
                $('[data-toggle="popover"]').popover();
                if ($('.popover.fade.right.in').length > 0) {
                    $('.popover.fade.right.in').remove();
                }
                setTimeout(scrollDownScrollDowns(), 100);
                if(typeof updateGoobiScriptIndicator !== 'undefined') {
                	setTimeout(updateGoobiScriptIndicator, 500);
                }
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function () {
                var myButton = $("a[id$=':navnext']")
                if (myButton != null) {
                    myButton.click();
                }
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function () {
                var myButton = $("a[id$=':navprev']")
                if (myButton != null) {
                    myButton.click();
                }
            });

            window.myfaces = window.myfaces || {};
            myfaces.config = myfaces.config || {};
            //set the config part
            myfaces.config.no_portlet_env = true;
            
            
            
            var simpleTinyMceConfig = {
                    selector: '.tinymce',
                    setup: function( editor ) {
                        editor.on( 'change', function() {
                            tinymce.triggerSave();
                        } );
                    },
                    statusbar: true,
                    height: 200,
                    menu: {},
                    relative_urls: false,
                    remove_script_host: false,
                    plugins: [
                        'advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker',
                        'searchreplace wordcount visualblocks visualchars code insertdatetime media nonbreaking',
                        'save table contextmenu directionality emoticons template paste'],
                    content_css: 'css/content.css',
                    toolbar: 'undo redo | styleselect | bold italic underline strikethrough | bullist numlist | image link | fullscreen code',
                    menubar: false,
                    content_css: 'css/content.css',
                    statusbar: false,
                    init_instance_callback: function( editor ) {
                        var readOnlyAttr = $( "#" + editor.id.replace( ":", "\\:" ) ).attr( "readonly" );
                        if ( readOnlyAttr === "readonly" ) {
                            editor.setMode( "readonly" );
                        }
                    },
                    setup: function( editor ) {
                        editor.on( "blur", function( event, a, b ) {
                            editor.save();
                            $( "#" + editor.id.replaceAll( ":", "\\:" ) ).trigger( "change" );
                        } );
                    }

                };

                function initTinyMce() {
                    console.log( "Init tinyMce", simpleTinyMceConfig);
                    tinymce.init( simpleTinyMceConfig );
                }

                $( window ).on( "load", function() {
                    renderInputFields()
                } )

                jsf.ajax.addOnEvent( function( data ) {
                    var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
                    switch ( ajaxstatus ) {
                        case "success": // This is called when ajax response is successfully processed.
                            renderInputFields()
                            break;
                    }
                } );

                function renderInputFields( ajaxData ) {
                    if ( typeof tinyMCE !== 'undefined' ) {
                        if ( ajaxData === undefined || ajaxData.status == "begin" ) {
                            for ( edId in tinyMCE.editors ) {
                                try {
                                    tinyMCE.editors[ edId ].remove();
                                    console.log( "Removed editor " + edId );
                                }
                                catch ( error ) {
                                    console.log( "Error occured during removing editors; ", error );
                                }
                            }
                        }
                        if ( ajaxData === undefined || ajaxData.status == "success" ) {
                            initTinyMce( ajaxData );
                        }
                    }
                }
                
                function showLoader(data) {
                	if(data?.status == "begin") {
                		$("#ajaxLoader").show();
                	} else {
                		$("#ajaxLoader").hide();
                	}
                }

         // ]]>

        </script>
        <div id="ajaxLoader" class="ajax-loader-overlay">
        	<img src="template/img/goobi/ajaxloader2.gif" alt="Loading..." />
        </div>
    </f:view>
</h:body>
</html>
