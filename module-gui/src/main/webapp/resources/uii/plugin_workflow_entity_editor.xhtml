<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:entity="http://entity.goobi.io/facelets"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="template.html">

    <composite:interface>
    </composite:interface>


    <ui:define name="navigation">

        <h:form id="menu" styleClass="d-flex justify-content-between w-100">
            <ul id="main-menu-set-class" class="navbar-nav">
                <!-- Dropdown-MenÃ¼: "Startseite" / "Home page" -->
                <li class="nav-item #{NavigationForm.parentMenu == 'menu_start' ? 'active' : ''}">
                    <button
                        class="nav-link"
                        jsf:id="exit"
                        jsf:action="#{NavigationForm.workflowPlugin.exitPlugin}">
                        <h:outputText value="#{msgs.plugin_workflow_entity_exit}" />
                    </button>
                </li>
            </ul>
            <ui:include src="/uii/template/inc_menu_preferences.xhtml" />

        </h:form>

    </ui:define>

    <ui:define name="content">

        <main class="plugin-entity-editor">
            <div class="main-wrapper">
                <div class="header">
                    <h:form
                        styleClass="header__bottom"
                        id="headform"
                        prependId="false">


                        <!-- display current type , icons to search types-->
                        <div class="row w-100 justify-content-between">
                            <div
                                class="col-md-4"
                                jsf:id="header">
                                <h1>
                                    <h:outputFormat value="#{msgs.plugin_workflow_entity_header}" rendered="#{NavigationForm.workflowPlugin.entity != null}">
                                        <f:param value="#{msgs[NavigationForm.workflowPlugin.entity.currentType.name]}" />
                                        <f:param value="#{msgs[NavigationForm.workflowPlugin.entity.entityName]}" />
                                    </h:outputFormat>
                                </h1>
                            </div>
                            <ul class="col-md-8 d-flex justify-content-end" role="list">
                                <ui:repeat
                                    var="type"
                                    value="#{NavigationForm.workflowPlugin.allEntityTypes}">
                                    <li>
                                        <button
                                            type="button"
                                            class="btn entity-search entity-search"
                                            style="--entity-search-color: #{type.color};"
                                            jsf:action="#{NavigationForm.workflowPlugin.searchForType(type)}"
                                            jsf:onclick="$('#searchEntitySearchBox').modal('show');">
                                            <span class="fa #{type.icon} big-icon"
                                                aria-hidden="true" />
                                            <h:outputText
                                                value="#{msgs[type.plural]}"
                                                styleClass="btn-text" />
                                            <f:ajax
                                                execute="@this"
                                                render=":searchEntityModalContent" />
                                        </button>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </div>
                        <h:panelGroup
                            layout="block"
                            id="breadcrumbs"
                            styleClass="breadcrumbs bg-transparent">
                            <div class="breadcrumb-label">
                                <h:outputText
                                    rendered="#{!NavigationForm.workflowPlugin.breadcrumbList.isEmpty()}"
                                    styleClass="skew-fix"
                                    style="padding-left: 5px"
                                    value="#{msgs.plugin_workflow_entity_myTabs}:" />
                            </div>
                            <ul class="breadcrumb-container" role="list">
                                <ui:repeat
                                    var="breadcrumb"
                                    value="#{NavigationForm.workflowPlugin.breadcrumbList}">
                                    <li>
                                        <entity:entity_breadcrumb
                                            entityType="#{breadcrumb.entityType}"
                                            entityName="#{msgs[breadcrumb.entityName]}"
                                            entityColor="#{breadcrumb.color}"
                                            entityIcon="#{breadcrumb.icon}" />
                                    </li>
                                </ui:repeat>
                            </ul>
                        </h:panelGroup>
                    </h:form>
                </div>


                <div class="row">
                    <div class="col-md-12 col-lg-6">
                        <div
                            class="box box--outline #{NavigationForm.workflowPlugin.entity.currentType.name}"
                            jsf:rendered="#{NavigationForm.workflowPlugin.entity != null}"
                            style="--box-color: #{NavigationForm.workflowPlugin.entity.currentType.color}">

                            <div
                                class="box-title text-white"
                                jsf:style="background: #{NavigationForm.workflowPlugin.entity.currentType.color}; border-color: #{NavigationForm.workflowPlugin.entity.currentType.color};">
                                <h3>
                                    <i class="fa #{NavigationForm.workflowPlugin.entity.currentType.icon} big-icon" />

                                    <h:outputFormat value="#{msgs.plugin_workflow_entity_edit_header}">
                                        <f:param value="#{NavigationForm.workflowPlugin.entity.currentType.name}" />
                                        <f:param value="#{msgs[NavigationForm.workflowPlugin.entity.entityName]}" />
                                    </h:outputFormat>

                                </h3>

                                <button
                                    jsf:rendered="#{NavigationForm.workflowPlugin.entity.showGenerateBibliographyButton}"
                                    jsf:style="background: #{NavigationForm.workflowPlugin.entity.currentType.color};"
                                    class="btn btn-link btn--generateBibliography"
                                    jsf:id="generateBibliography"
                                    jsf:action="#{NavigationForm.workflowPlugin.entity.generateBibliography}"
                                    title="#{msgs.plugin_workflow_entity_createBibliography}"
                                    data-bs-toggle="tooltip"
                                    data-bs-placement="#{status.index == 1 ? 'bottom' : 'top' }">
                                    <i class="fa fa-plus-circle margin-right-5 big-icon" />
                                </button>


                            </div>
                            <div
                                class="box-content nopadding"
                                jsf:style="border-color: #{NavigationForm.workflowPlugin.entity.currentType.color};">

                                <h:form
                                    styleClass="form-horizontal form-bordered"
                                    prependId="false"
                                    enctype="multipart/form-data"
                                    id="metadataForm">

                                    <!-- badges area -->
                                    <h:panelGroup
                                        id="badge-area"
                                        layout="block"
                                        styleClass="badge-area">
                                        <ui:repeat
                                            var="item"
                                            value="#{NavigationForm.workflowPlugin.entity.metadataFieldList}">
                                            <ui:fragment>
                                                <entity:entity_badge
                                                    styleclassname="#{!item.filled ? 'badge-empty rounded-pill' : 'badge-intranda-light'}"
                                                    fieldname="#{msgs[item.label]}"
                                                    showfield="#{item.showField}" />
                                            </ui:fragment>
                                        </ui:repeat>
                                    </h:panelGroup>

                                    <!-- list all metadata fields -->
                                    <div class="main-area">
                                        <ui:repeat
                                            value="#{NavigationForm.workflowPlugin.entity.metadataFieldList}"
                                            var="configuredField"
                                            varStatus="status">
                                            <ui:repeat
                                                var="field"
                                                value="#{configuredField.metadataList}"
                                                rendered="#{configuredField.showField}">

                                                <div class="form-group">
                                                    <div class="col-sm-3 control-label">

                                                        <h:outputLabel
                                                            for="field_#{status.index}"
                                                            value="#{msgs[configuredField.label]}" />
                                                        <!-- publish button -->
                                                        <h:panelGroup id="pubBtn">
                                                            <button
                                                                type="button"
                                                                class="btn pull-right toggle"
                                                                jsf:id="toggle-export"
                                                                jsf:rendered="#{field.displayPublishButton}"
                                                                title="#{ field.publishField.booleanValue == false ? msgs.plugin_workflow_entity_publish : msgs.plugin_workflow_entity_doNotPublish }"
                                                                data-bs-toggle="tooltip"
                                                                data-bs-placement="#{status.index == 1 ? 'bottom' : 'top' }">
                                                                <i
                                                                    class="fa #{field.publishField.booleanValue == false?'fa fa-toggle-off':'fa fa-toggle-on toggle-on'}" />
                                                                <f:ajax
                                                                    execute="pubBtn"
                                                                    render="pubBtn" />
                                                                <f:setPropertyActionListener
                                                                    value="#{not field.publishField.booleanValue}"
                                                                    target="#{field.publishField.booleanValue}" />
                                                            </button>
                                                        </h:panelGroup>

                                                        <!-- delete button -->
                                                        <button
                                                            type="button"
                                                            class="btn pull-right toggle"
                                                            jsf:id="remove"
                                                            jsf:action="#{NavigationForm.workflowPlugin.entity.removeMetadata(field)}"
                                                            title="#{msgs.plugin_workflow_entity_delete}"
                                                            data-bs-toggle="tooltip"
                                                            data-bs-placement="#{status.index == 1 ? 'bottom' : 'top' }">
                                                            <i class="fa fa-minus-circle" />
                                                            <f:ajax
                                                                execute="@this"
                                                                render="@form" />
                                                        </button>


                                                        <!-- duplicate button -->
                                                        <button
                                                            type="button"
                                                            class="btn pull-right toggle"
                                                            jsf:id="duplicate"
                                                            jsf:rendered="#{field.configField.repeatable}"
                                                            jsf:action="#{NavigationForm.workflowPlugin.entity.duplicateMetadata(configuredField)}"
                                                            title="#{msgs.plugin_workflow_entity_duplicate}"
                                                            data-bs-toggle="tooltip"
                                                            data-bs-placement="#{status.index == 1 ? 'bottom' : 'top' }">
                                                            <i class="fa fa-plus-circle" />
                                                            <f:ajax
                                                                execute="@this"
                                                                render="@form" />
                                                        </button>

                                                        <!-- button to add source-->
                                                        <button
                                                            type="button"
                                                            jsf:rendered="#{field.allowSources}"
                                                            jsf:id="addSource"
                                                            class="btn pull-right toggle "
                                                            jsf:onclick="$('#sourceSearchBox').modal('show');"
                                                            title="#{msgs.plugin_workflow_entity_addSource}"
                                                            data-bs-toggle="tooltip"
                                                            data-bs-placement="#{status.index == 1 ? 'bottom' : 'top' }">
                                                            <i class="fa fa-quote-left" />
                                                            <f:ajax
                                                                execute="@this"
                                                                render=":sourceModalContent" />
                                                            <f:setPropertyActionListener
                                                                value="#{field}"
                                                                target="#{NavigationForm.workflowPlugin.currentField}" />
                                                            <f:setPropertyActionListener
                                                                value=""
                                                                target="#{NavigationForm.workflowPlugin.sourceMode}" />
                                                        </button>


                                                    </div>

                                                    <h:panelGroup
                                                        layout="block"
                                                        rendered="#{!field.configField.group}"
                                                        styleClass="col-sm-9">

                                                        <ui:fragment
                                                            rendered="#{field.configField.fieldType == 'input' or field.configField.fieldType == 'generated'}">
                                                            <h:inputText
                                                                styleClass="form-control"
                                                                value="#{field.metadata.value}"
                                                                required="false"
                                                                id="field_#{status.index}"
                                                                readonly="#{field.configField.readonly  or field.configField.fieldType == 'generated'}">
                                                                <f:ajax
                                                                    execute="@this"
                                                                    render="badge-area :header"
                                                                    event="blur"
                                                                    listener="#{NavigationForm.workflowPlugin.updateDisplayName}" />
                                                            </h:inputText>
                                                        </ui:fragment>

                                                        <ui:fragment rendered="#{field.configField.fieldType == 'checkbox'}">
                                                            <h:selectBooleanCheckbox
                                                                styleClass="form-control checkbox-height-fix"
                                                                style="width: auto;"
                                                                value="#{field.booleanValue}">
                                                                <f:ajax
                                                                    event="change"
                                                                    render="badge-area" />
                                                            </h:selectBooleanCheckbox>
                                                        </ui:fragment>
                                                        <ui:fragment rendered="#{field.configField.fieldType == 'select'}">
                                                            <h:selectOneMenu
                                                                styleClass="form-control"
                                                                value="#{field.metadata.value}">
                                                                <f:ajax
                                                                    event="change"
                                                                    render="badge-area :header"
                                                                    listener="#{NavigationForm.workflowPlugin.updateDisplayName}" />
                                                                <f:selectItem
                                                                    itemValue=""
                                                                    itemLabel="#{msgs.bitteAuswaehlen}"
                                                                    itemDisabled="true" />
                                                                <f:selectItems
                                                                    value="#{field.configField.valueList}"
                                                                    var="item"
                                                                    itemLabel="#{msgs[item]}"
                                                                    itemValue="#{item}" />
                                                            </h:selectOneMenu>
                                                        </ui:fragment>

                                                        <ui:fragment rendered="#{field.configField.fieldType == 'vocabularyList'}">
                                                            <h:selectOneMenu
                                                                styleClass="form-select"
                                                                value="#{field.vocabularyValue}">
                                                                <f:ajax
                                                                    event="change"
                                                                    render="badge-area :header"
                                                                    listener="#{NavigationForm.workflowPlugin.updateDisplayName}" />
                                                                <f:selectItem
                                                                    itemValue=""
                                                                    itemLabel="#{msgs.bitteAuswaehlen}"
                                                                    itemDisabled="false" />
                                                                <f:selectItems
                                                                    value="#{field.configField.vocabularyList}"
                                                                    var="item"
                                                                    itemLabel="#{item.getLabel(SpracheForm.locale)}"
                                                                    itemValue="#{item.mainValue}" />
                                                            </h:selectOneMenu>
                                                        </ui:fragment>

                                                    </h:panelGroup>

                                                    <h:panelGroup
                                                        id="group"
                                                        layout="block"
                                                        rendered="#{field.configField.group}"
                                                        styleClass="col-sm-9">
                                                        <ui:repeat
                                                            var="subfield"
                                                            value="#{field.subfields}">
                                                            <h:panelGroup
                                                                layout="block"
                                                                styleClass="group-metadata #{subfield.configField.labelPosition == 'left' ? 'language-field' : ''}"
                                                                rendered="#{subfield.configField.fieldType != 'language' and subfield.configField.fieldType != 'publish'}">

                                                                <h:outputText
                                                                    styleClass="field-label"
                                                                    value="#{msgs[subfield.configField.label]}"
                                                                    rendered="#{subfield.configField.fieldType != 'publish' and subfield.configField.labelPosition != 'none'}" />

                                                                <h:panelGroup
                                                                    rendered="#{subfield.configField.fieldType == 'input' or subfield.configField.fieldType == 'generated'}"
                                                                    id="inputGroup">
                                                                    <h:inputText
                                                                        styleClass="form-control"
                                                                        value="#{subfield.metadata.value}"
                                                                        required="false"
                                                                        validator="#{subfield.requiredValidator}"
                                                                        readonly="#{subfield.configField.readonly  or subfield.configField.fieldType == 'generated'}"
                                                                        id="inputField">
                                                                        <f:ajax
                                                                            execute="@this"
                                                                            render="badge-area :header"
                                                                            event="blur"
                                                                            listener="#{NavigationForm.workflowPlugin.updateDisplayName}" />
                                                                    </h:inputText>
                                                                    <h:panelGroup
                                                                        layout="block"
                                                                        rendered="#{!subfield.valid}"
                                                                        styleClass="font-danger validation-message">
                                                                        <h:outputText value="#{subfield.validationErrorMessage}" />
                                                                    </h:panelGroup>
                                                                </h:panelGroup>

                                                                <h:inputTextarea
                                                                    styleClass="form-control tinymce"
                                                                    value="#{subfield.metadata.value}"
                                                                    required="false"
                                                                    rendered="#{subfield.configField.fieldType == 'textarea'}"
                                                                    readonly="#{subfield.configField.readonly}">
                                                                    <f:ajax
                                                                        execute="@this"
                                                                        render="badge-area :header"
                                                                        event="change"
                                                                        listener="#{NavigationForm.workflowPlugin.updateDisplayName}" />
                                                                </h:inputTextarea>

                                                                <ui:fragment rendered="#{subfield.configField.fieldType == 'select'}">
                                                                    <h:selectOneMenu
                                                                        styleClass="form-control"
                                                                        value="#{subfield.metadata.value}">
                                                                        <f:ajax
                                                                            event="change"
                                                                            render="badge-area" />
                                                                        <f:selectItem
                                                                            itemValue=""
                                                                            itemLabel="#{msgs.bitteAuswaehlen}"
                                                                            itemDisabled="true" />
                                                                        <f:selectItems
                                                                            value="#{subfield.configField.valueList}"
                                                                            var="item"
                                                                            itemLabel="#{msgs[item]}"
                                                                            itemValue="#{item}" />
                                                                    </h:selectOneMenu>
                                                                </ui:fragment>

                                                                <ui:fragment rendered="#{subfield.configField.fieldType == 'vocabularyList'}">
                                                                    <h:selectOneMenu
                                                                        styleClass="form-select"
                                                                        value="#{subfield.vocabularyValue}">
                                                                        <f:ajax
                                                                            event="change"
                                                                            render="badge-area" />
                                                                        <f:selectItem
                                                                            itemValue=""
                                                                            itemLabel="#{msgs.bitteAuswaehlen}"
                                                                            itemDisabled="false" />
                                                                        <f:selectItems
                                                                            value="#{subfield.configField.vocabularyList}"
                                                                            var="item"
                                                                            itemLabel="#{item.getLabel(SpracheForm.locale)}"
                                                                            itemValue="#{item.mainValue}" />
                                                                    </h:selectOneMenu>
                                                                </ui:fragment>

                                                                <ui:fragment rendered="#{subfield.configField.fieldType == 'vocabularySearch'}">
                                                                    <div class="vocabulary-search">
                                                                        <h:inputText
                                                                            styleClass="form-control"
                                                                            value="#{subfield.metadata.value}"
                                                                            required="false"
                                                                            id="field_#{status.index}"
                                                                            readonly="true">
                                                                            <f:ajax
                                                                                execute="@this"
                                                                                render="badge-area"
                                                                                event="blur" />
                                                                        </h:inputText>
                                                                        <span>
                                                                            <button
                                                                                jsf:id="vocabularySearch"
                                                                                class="btn vocabularySearchIndexTrigger btn--icon-light metadataButton pull-right viaf-btn"
                                                                                title="#{msgs.NORM_vocabularySearch}"
                                                                                aria-label="#{msgs.NORM_vocabularySearch}"
                                                                                type="button"
                                                                                jsf:onclick="$('#vocabularySearchBox').modal('show');">
                                                                                <img
                                                                                    class="toggle"
                                                                                    style="width: 16px;"
                                                                                    alt="Vocabulary"
                                                                                    src="template/img/Icons_Vocabulary_color.png" />
                                                                                <f:setPropertyActionListener
                                                                                    value="#{subfield}"
                                                                                    target="#{NavigationForm.workflowPlugin.searchField}" />
                                                                                <f:ajax
                                                                                    execute="@this"
                                                                                    render=":vocabularySearchModalContent" />
                                                                                <f:passThroughAttribute
                                                                                    name="data-bs-toggle"
                                                                                    value="tooltip" />
                                                                                <f:passThroughAttribute
                                                                                    name="data-bs-placement"
                                                                                    value="top" />
                                                                            </button>
                                                                        </span>
                                                                    </div>
                                                                </ui:fragment>
                                                                <ui:fragment rendered="#{subfield.configField.fieldType == 'fileupload'}">
                                                                    <h:panelGroup id="imageArea">
                                                                        <h:inputFile
                                                                            rendered="#{subfield.image == null}"
                                                                            id="thirdtab_fileupload3"
                                                                            value="#{subfield.uploadedFile}"
                                                                            storage="file"
                                                                            styleClass="form-control form-control-file"
                                                                            style="border: 0;padding-left: 0px;"
                                                                            required="false">
                                                                            <f:ajax
                                                                                listener="#{subfield.uploadFile}"
                                                                                render="imageArea"
                                                                                onevent="showLoader" />
                                                                        </h:inputFile>
                                                                        <ui:fragment rendered="#{subfield.image != null and subfield.image.type == 'image'}">
                                                                            <div
                                                                                class="goobi-thumbnail"
                                                                                dir="auto">
                                                                                <div
                                                                                    class="goobi-thumbnail-image"
                                                                                    style="height: 200px; max-width: 200px">

                                                                                    <div
                                                                                        class="thumb"
                                                                                        style="max-height: 200px;">
                                                                                        <button
                                                                                            title="#{subfield.image.tooltip}"
                                                                                            class="colorbox-image"
                                                                                            data-bs-toggle="tooltip"
                                                                                            href="#{subfield.image.bookmarkUrl}"
                                                                                            jsf:id="showBookmark1"
                                                                                            jsf:onclick="$('#imageBox').modal('show');">
                                                                                            <canvas
                                                                                                class="thumb-canvas"
                                                                                                style="max-height: 200px;"
                                                                                                data-image_small="#{subfield.image.thumbnailUrl}"
                                                                                                data-image_large="#{subfield.image.largeThumbnailUrl}"
                                                                                                title="#{subfield.image.tooltip}"
                                                                                                id="thumbnail"></canvas>
                                                                                            <f:setPropertyActionListener
                                                                                                value="#{subfield.image.largeThumbnailUrl}"
                                                                                                target="#{NavigationForm.workflowPlugin.imageUrl}" />
                                                                                            <f:setPropertyActionListener
                                                                                                value="#{subfield.image.tooltip}"
                                                                                                target="#{NavigationForm.workflowPlugin.imageName}" />
                                                                                            <f:ajax
                                                                                                execute="@this"
                                                                                                render="imageBoxContent" />
                                                                                        </button>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </ui:fragment>
                                                                    </h:panelGroup>
                                                                </ui:fragment>
                                                                <h:panelGroup
                                                                    rendered="#{subfield.configField.fieldType == 'date'}"
                                                                    id="group">
                                                                    <h:inputText
                                                                        styleClass="form-control"
                                                                        value="#{subfield.metadata.value}"
                                                                        required="false"
                                                                        readonly="false"
                                                                        id="dateField"
                                                                        validator="#{subfield.dateValidator}">
                                                                        <f:ajax
                                                                            execute="@this"
                                                                            render="badge-area group"
                                                                            event="blur" />
                                                                    </h:inputText>
                                                                    <h:panelGroup
                                                                        layout="block"
                                                                        rendered="#{!subfield.valid}"
                                                                        styleClass="font-danger validation-message">
                                                                        <h:outputText value="#{subfield.validationErrorMessage}" />
                                                                    </h:panelGroup>
                                                                </h:panelGroup>

                                                                <ui:fragment rendered="#{subfield.configField.fieldType == 'geonames'}">
                                                                    <div class="geonames-search">
                                                                        <h:inputText
                                                                            styleClass="form-control"
                                                                            value="#{subfield.metadata.value}"
                                                                            required="false"
                                                                            id="geonamesfield_#{status.index}"
                                                                            readonly="true">
                                                                            <f:ajax
                                                                                execute="@this"
                                                                                render="badge-area"
                                                                                event="blur" />
                                                                        </h:inputText>
                                                                        <span>
                                                                            <button
                                                                                jsf:id="geonamesSearch"
                                                                                class="btn geonamesSearchIndexTrigger btn--icon-light metadataButton pull-right viaf-btn"
                                                                                title="#{msgs.NORM_geonamesSearch}"
                                                                                aria-label="#{msgs.NORM_geonamesSearch}"
                                                                                type="button"
                                                                                jsf:onclick="$('#geonamesSearchBox').modal('show');">
                                                                                <img
                                                                                    class="toggle"
                                                                                    style="width: 16px;"
                                                                                    alt="Vocabulary"
                                                                                    src="template/img/Icons_GeoNames_color.png" />
                                                                                <f:setPropertyActionListener
                                                                                    value="#{subfield}"
                                                                                    target="#{NavigationForm.workflowPlugin.searchField}" />
                                                                                <f:ajax
                                                                                    execute="@this"
                                                                                    render=":geonamesSearchModalContent" />
                                                                                <f:passThroughAttribute
                                                                                    name="data-bs-toggle"
                                                                                    value="tooltip" />
                                                                                <f:passThroughAttribute
                                                                                    name="data-bs-placement"
                                                                                    value="top" />
                                                                            </button>
                                                                        </span>
                                                                    </div>
                                                                </ui:fragment>


                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                        <ui:include src="includes/sources.xhtml" />
                                                    </h:panelGroup>
                                                </div>
                                            </ui:repeat>
                                        </ui:repeat>

                                    </div>
                                </h:form>
                                <!-- vocabulary search modal -->
                                <ui:include src="includes/vocabulary_search_modal.xhtml" />
                                <!-- geonames search modal -->
                                <ui:include src="includes/geonames_search_modal.xhtml" />
                                <!-- sources modal -->
                                <ui:include src="includes/source_modal.xhtml" />
                                <ui:include src="includes/image_modal.xhtml" />
                            </div>
                        </div>
                    </div>





                    <div class="col-sm-12 col-md-6">
                        <h:form>
                            <ui:repeat
                                var="type"
                                value="#{NavigationForm.workflowPlugin.entity.linkedRelationships}">

                                <ui:include src="includes/linked_entities.xhtml" />

                            </ui:repeat>
                        </h:form>
 						<ui:include src="includes/edit_relationship_modal.xhtml" />
                    </div>

                </div>
                <!-- end row -->



                <!-- link entity modal -->
                <ui:include src="includes/link_entity_modal.xhtml" />
                <ui:include src="includes/search_entity_modal.xhtml" />
                <h:inputHidden
                    value="#{NavigationForm.workflowPlugin.mainScrollPosition}"
                    id="scrollpos" />

            </div>
            <div class="row editor-actions">
                <h:form styleClass="col-sm-12">

                    <ui:fragment rendered="#{LoginForm.hasRole('Plugin_Workflow_Entity_Deletion')}">
                        <button
                            jsf:id="deleteEntity"
                            class="btn"
                            jsf:action="#{NavigationForm.workflowPlugin.deleteEntity}"
                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">#{msgs.plugin_workflow_entity_editor_delete}</button>
                    </ui:fragment>

                    <button
                        class="btn"
                        jsf:id="save"
                        jsf:action="#{NavigationForm.workflowPlugin.saveEntity}">
                        <h:outputText value="#{msgs.save}" />
                    </button>


                    <div class="dropup dropdown--exportBtn">


                        <button
                            jsf:id="exportBtnDropdownToggle"
                            class="btn"
                            aria-haspopup="true"
                            aria-expanded="false"
                            onclick="switchExpanded(this.id)"
                            data-bs-toggle="dropdown"
                            type="button">
                            #{msgs.plugin_workflow_entity_export}
                            <span class="caret"></span>
                        </button>

                        <div class="dropdown-menu">

                            <button
                                class="btn btn-link"
                                jsf:id="exportSingle"
                                jsf:action="#{NavigationForm.workflowPlugin.exportSingleRecord}"
                                type="button">
                                <h:outputText value="#{msgs.plugin_workflow_entity_exportSingleRecord}" />
                                <f:ajax execute="@this" render="messages" onevent="showLoader" />
                            </button>

                            <button
                                class="btn btn-link"
                                jsf:id="exportAll"
                                jsf:action="#{NavigationForm.workflowPlugin.exportAllRecords}"
                                type="button">
                                <h:outputText value="#{msgs.plugin_workflow_entity_exportRecordWithDependencies}" />
                                <f:ajax execute="@this" render="messages" onevent="showLoader"/>
                            </button>

                        </div>

                    </div>

                </h:form>
            </div>


            <script type="text/javascript">

            function openEditRelationshipModal(data) {
            	showLoader(data);
            	if(data?.status == "success") {
            		$('#relationshipEditBox').modal('show');
            	}
            }

            function loadColorbox () {
                $.colorbox.remove();

                // set colorboxes
                $( '.colorbox-image' ).colorbox( {
                    transition: 'fade',
                    rel: 'colorbox-image',
                    maxWidth: '90%',
                    maxHeight: '90%',
                } );
            }
			window.onload = function() {
				loadImages();
			}
			faces.ajax.addOnEvent( function( data ) {
                var ajaxstatus = data.status;
                switch ( ajaxstatus ) {
                    case "begin":
                        var scrollPosition = $( '.main-area' ).scrollTop();
                        $( '#scrollpos' ).val( scrollPosition );
                        break;
                    case "success":
                        var scrollPosition = $( '#scrollpos' ).val();
                        $( '.main-area' ).scrollTop( scrollPosition );
						loadImages();
                        break;
                }
            } );
        </script>

        </main>
    </ui:define>

</ui:composition>
