<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:entity="http://entity.goobi.io/facelets"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="template.html">

    <composite:interface>
    </composite:interface>


    <ui:define name="navigation">
        <h:form id="menu">
            <div>
                <a
                    aria-label="intranda Logo"
                    id="brand"
                    jsf:action="#{NavigationForm.workflowPlugin.exitPlugin}"> </a>
            </div>

            <button
                class="btn pull-left"
                jsf:id="exit"
                jsf:action="#{NavigationForm.workflowPlugin.exitPlugin}">
                <h:outputText value="#{msgs.plugin_workflow_entity_exit}" />
            </button>

            <div class="user pull-right">
                <ul class="icon-nav">
                    <!-- Icon to enable help texts -->
                    <li>
                        <button
                            class="btn"
                            jsf:id="showHelp"
                            aria-label="#{msgs.showHelpMessages}"
                            jsf:action="#{NavigationForm.Reload}"
                            title="#{NavigationForm.showHelp?msgs.hideHelpMessages:msgs.showHelpMessages}"
                            jsf:rel="tooltip"
                            data-placement="bottom">
                            <i class="fa #{not NavigationForm.showHelp?'fa-question':'fa-question-circle'}"></i>
                            <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip" />
                            <f:setPropertyActionListener
                                target="#{NavigationForm.showHelp}"
                                value="#{not NavigationForm.showHelp}" />
                        </button>
                    </li>

                    <!-- Icon to select language -->
                    <li class="dropdown language-select">
                        <div
                            data-toggle="tooltip"
                            title="#{msgs.spracheAendern}"
                            data-placement="bottom">
                            <button
                                type="button"
                                id="nav-language"
                                aria-label="#{msgs.spracheAendern}"
                                data-toggle="dropdown"
                                aria-haspopup="true"
                                class="dropdown-toggle btn"
                                jsf:rel="tooltip">

                                <img
                                    alt="#{SpracheForm.locale}"
                                    src="template/img/flags/#{SpracheForm.locale}.gif" />
                                <span></span>
                            </button>
                            <ul class="dropdown-menu pull-right">
                                <ui:repeat
                                    var="availableLanguage"
                                    value="#{SpracheForm.supportedLocales}"
                                    id="plugin4">
                                    <li>
                                        <button
                                            jsf:id="locale"
                                            class="dropdown-item text_head"
                                            jsf:action="#{SpracheForm.SpracheUmschalten}"
                                            title="#{availableLanguage.displayLanguageTranslated}">
                                            <f:param
                                                name="locale"
                                                value="#{availableLanguage.id}" />
                                            <f:setPropertyActionListener
                                                value="#{null}"
                                                target="#{SessionForm.dateFormatter}" />
                                            <h:graphicImage value="template/img/flags/#{availableLanguage.id}.gif" />
                                            <span>
                                                <h:outputText value="#{msgs[availableLanguage.displayLanguageSelf]}" />
                                            </span>
                                        </button>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </div>
                    </li>
                </ul>
                <div class="dropdown">
                    <button
                        id="nav-account"
                        type="button"
                        class="dropdown-toggle btn"
                        aria-haspopup="true"
                        data-toggle="dropdown">
                        <h:outputText
                            rendered="#{LoginForm.myBenutzer != null}"
                            value="#{LoginForm.myBenutzer.vorname} #{LoginForm.myBenutzer.nachname}" />
                        <c:if test="#{empty LoginForm.myBenutzer.imageUrl}">
                            <img
                                alt=""
                                src="template/img/intranda.png" />
                        </c:if>
                        <c:if test="#{not empty LoginForm.myBenutzer.imageUrl}">
                            <img
                                alt=""
                                src="#{LoginForm.myBenutzer.imageUrl}" />
                        </c:if>
                    </button>

                    <ul class="dropdown-menu pull-right">
                        <!-- User settings -->
                        <intranda:menuItem
                            id="a50"
                            parentMenu="menu_account"
                            label="#{msgs.benutzerkonfiguration}"
                            action="user_config"
                            display="#{NavigationForm.uiStatus.user_config}"
                            icon="fa fa-user-circle-o box-icon-fix-menu-up3" />

                        <!-- Change password -->
                        <h:panelGroup rendered="#{HelperForm.passwordIsChangable}">
                            <intranda:menuItem
                                id="a51"
                                parentMenu="menu_account"
                                label="#{msgs.passwortAendern}"
                                action="user_password"
                                icon="fa fa-key box-icon-fix-menu-up3" />
                        </h:panelGroup>


                        <!-- Logout -->
                        <ui:fragment rendered="#{!LoginForm.showSSOLogoutPage}">
                            <intranda:menuItem
                                id="a52"
                                parentMenu="menu_account"
                                label="#{msgs.logout}"
                                action="#{LoginForm.Ausloggen}"
                                icon="fa fa-power-off box-icon-fix-menu" />
                        </ui:fragment>
                        <ui:fragment rendered="#{LoginForm.showSSOLogoutPage}">
                            <intranda:menuItem
                                id="openIdLogout"
                                parentMenu="menu_account"
                                label="#{msgs.logout}"
                                action="#{LoginForm.logoutOpenId}"
                                icon="fa fa-power-off box-icon-fix-menu" />
                        </ui:fragment>

                    </ul>
                </div>

            </div>
        </h:form>

    </ui:define>

    <ui:define name="content">

        <main>
            <div>
                <div class="head">
                    <h:form
                        id="headform"
                        prependId="false">


                        <!-- display current type , icons to search types-->
                        <div class="search-row row">
                            <div
                                class="col-sm-4"
                                jsf:id="header">
                                <h1>
                                    <h:outputFormat value="#{msgs.plugin_workflow_entity_header}">
                                        <f:param value="#{NavigationForm.workflowPlugin.entity.currentType.name}" />
                                        <f:param value="#{NavigationForm.workflowPlugin.entity.entityName}" />
                                    </h:outputFormat>
                                </h1>
                            </div>
                            <div class="col-sm-8">
                                <ul class="pull-right">
                                    <li>
                                        <ui:repeat
                                            var="type"
                                            value="#{NavigationForm.workflowPlugin.allEntityTypes}">

                                            <style>
                                                .entity-search--#{type.plural} {
                                                    background-color: #{type.color};
                                                    color: #fff;
                                                }
                                                .entity-search--#{type.plural}:hover {
                                                    background-color: #{type.color};
                                                    background-image: linear-gradient(rgb(0 0 0/40%) 0 0);
                                                    color: #fff;
                                                }
                                            </style>

                                            <button
                                                class="btn entity-search entity-search--#{type.plural}"
                                                jsf:action="#{NavigationForm.workflowPlugin.searchForType(type)}"
                                                jsf:onclick="$('#searchEntitySearchBox').modal('show');">
                                                <i class="fa #{type.icon} big-icon" />
                                                <h:outputText
                                                    value="#{type.plural}"
                                                    styleClass="btn-text" />
                                                <f:ajax
                                                    execute="@this"
                                                    render=":searchEntityModalContent" />
                                            </button>
                                        </ui:repeat>

                                    </li>
                                </ul>
                            </div>
                        </div>
                        <br />



                        <ul class="breadcrumb-container row">
                            <li>
                                <div>
                                    <div class="breadcrumb-label">
                                        <h:outputText
                                            styleClass="skew-fix"
                                            style="padding-left: 5px"
                                            value="My Tabs:" />
                                    </div>
                                </div>
                            </li>
                            <ui:repeat
                                var="breadcrumb"
                                value="#{NavigationForm.workflowPlugin.breadcrumbList}">
                                <li>
                                    <entity:entity_breadcrumb
                                        entityType="#{breadcrumb.entityType}"
                                        entityName="#{breadcrumb.entityName}"
                                        entityColor="#{breadcrumb.color}"
                                        entityIcon="#{breadcrumb.icon}" />
                                </li>

                            </ui:repeat>
                            <!-- button to add new breadcrumbs -->
                            <!--
                            <li>
                                <button
                                    class="btn"
                                    style="background: #fff"
                                    jsf:action="#{NavigationForm.workflowPlugin.searchWithoutType}"
                                    jsf:onclick="$('#searchEntitySearchBox').modal('show');">
                                    <f:ajax
                                        execute="@this"
                                        render=":searchEntityModalContent" />
                                    <i class="fa fa-plus  big-icon" />
                                </button>
                            </li>
                            -->
                        </ul>
                    </h:form>
                </div>


                    <div class="row">
                        <div class="col-sm-12 col-md-6">
                            <div class="box box-color box-bordered #{NavigationForm.workflowPlugin.entity.currentType.name}">



                                <div
                                    class="box-title"
                                    jsf:style="background: #{NavigationForm.workflowPlugin.entity.currentType.color}; border-color: #{NavigationForm.workflowPlugin.entity.currentType.color};">
                                    <h3>
                                        <i class="fa #{NavigationForm.workflowPlugin.entity.currentType.icon} big-icon" />

                                        <h:outputFormat value="#{msgs.plugin_workflow_entity_edit_header}">
                                            <f:param value="#{NavigationForm.workflowPlugin.entity.currentType.name}" />
                                            <f:param value="#{NavigationForm.workflowPlugin.entity.entityName}" />
                                        </h:outputFormat>

                                    </h3>

                                    <button
                                        jsf:style="background: #{NavigationForm.workflowPlugin.entity.currentType.color};"
                                        class="btn btn-link btn--generateBibliography"
                                        jsf:id="generateBibliography"
                                        jsf:action="#{NavigationForm.workflowPlugin.entity.generateBibliography}"
                                        title="#{msgs.plugin_workflow_entity_createBibliography}"
                                        data-toggle="tooltip"
                                        data-placement="#{status.index == 1 ? 'bottom' : 'top' }"
                                        >
                                        <i class="fa fa-plus-circle margin-right-5 big-icon" />
                                    </button>


                                </div>
                                <div
                                    class="box-content nopadding"
                                    jsf:style="border-color: #{NavigationForm.workflowPlugin.entity.currentType.color};">

                                    <h:form
                                        styleClass="form-horizontal form-bordered"
                                        prependId="false"
                                        enctype="multipart/form-data"
                                        id="metadataForm">

                                        <!-- badges area -->
                                        <h:panelGroup
                                            id="badge-area"
                                            layout="block"
                                            styleClass="badge-area">
                                            <x:dataList
                                                var="item"
                                                value="#{NavigationForm.workflowPlugin.entity.metadataFieldList}">
                                                <ui:fragment>
                                                    <entity:entity_badge
                                                        styleclassname="#{!item.filled ? 'badge-empty' : 'badge-filled'}"
                                                        fieldname="#{msgs[item.name]}"
                                                        showfield="#{item.showField}" />
                                                </ui:fragment>
                                            </x:dataList>
                                        </h:panelGroup>

                                        <!-- list all metadata fields -->
                                        <div class="main-area">
                                            <ui:repeat
                                                value="#{NavigationForm.workflowPlugin.entity.metadataFieldList}"
                                                var="configuredField"
                                                varStatus="status">
                                                <ui:repeat
                                                    var="field"
                                                    value="#{configuredField.metadataList}"
                                                    rendered="#{configuredField.showField}">

                                                    <div class="form-group">
                                                        <div class="col-sm-3 control-label">

                                                            <h:outputLabel
                                                                for="field_#{status.index}"
                                                                value="#{msgs[configuredField.label]}" />
                                                            <!-- publish button -->
                                                            <h:panelGroup id="pubBtn">
                                                            <button
                                                                class="btn pull-right toggle"
                                                                jsf:id="toggle-export"
                                                                jsf:rendered="#{field.displayPublishButton}"
                                                                title="#{ field.publishField.booleanValue == false ? msgs.plugin_workflow_entity_publish : msgs.plugin_workflow_entity_doNotPublish }"
                                                                data-toggle="tooltip"
                                                                data-placement="#{status.index == 1 ? 'bottom' : 'top' }"
                                                                >
                                                                <i class="fa #{field.publishField.booleanValue == false?'fa fa-toggle-off':'fa fa-toggle-on toggle-on'}" />
                                                                <f:ajax
                                                                    execute="pubBtn"
                                                                    render="pubBtn" />
                                                                <f:setPropertyActionListener
                                                                    value="#{not field.publishField.booleanValue}"
                                                                    target="#{field.publishField.booleanValue}" />
                                                            </button>
                                                            </h:panelGroup>

                                                            <!-- delete button -->
                                                            <button
                                                                class="btn pull-right toggle"
                                                                jsf:id="remove"
                                                                jsf:action="#{NavigationForm.workflowPlugin.entity.removeMetadata(field)}"
                                                                title="#{msgs.plugin_workflow_entity_delete}"
                                                                data-toggle="tooltip"
                                                                data-placement="#{status.index == 1 ? 'bottom' : 'top' }"
                                                                >
                                                                <i class="fa fa-minus-circle" />
                                                                <f:ajax
                                                                    execute="@this"
                                                                    render="@form" />
                                                            </button>


                                                            <!-- duplicate button -->
                                                            <button
                                                                class="btn pull-right toggle"
                                                                jsf:id="duplicate"
                                                                jsf:rendered="#{field.configField.repeatable}"
                                                                jsf:action="#{NavigationForm.workflowPlugin.entity.duplicateMetadata(configuredField)}"
                                                                title="#{msgs.plugin_workflow_entity_duplicate}"
                                                                data-toggle="tooltip"
                                                                data-placement="#{status.index == 1 ? 'bottom' : 'top' }"
                                                                >
                                                                <i class="fa fa-plus-circle" />
                                                                <f:ajax
                                                                    execute="@this"
                                                                    render="@form" />
                                                            </button>

                                                            <!-- button to add source-->
                                                            <button
                                                                jsf:rendered="#{field.allowSources}"
                                                                jsf:id="addSource"
                                                                class="btn pull-right toggle "
                                                                jsf:onclick="$('#sourceSearchBox').modal('show');"
                                                                title="#{msgs.plugin_workflow_entity_addSource}"
                                                                data-toggle="tooltip"
                                                                data-placement="#{status.index == 1 ? 'bottom' : 'top' }"
                                                                >
                                                                <i class="fa fa-quote-left" />
                                                                <f:ajax
                                                                    execute="@this"
                                                                    render=":sourceModalContent" />
                                                                <f:setPropertyActionListener
                                                                    value="#{field}"
                                                                    target="#{NavigationForm.workflowPlugin.currentField}" />
                                                                <f:setPropertyActionListener
                                                                    value=""
                                                                    target="#{NavigationForm.workflowPlugin.sourceMode}" />
                                                            </button>


                                                        </div>

                                                        <h:panelGroup
                                                            layout="block"
                                                            rendered="#{!field.configField.group}"
                                                            styleClass="col-sm-9">

                                                            <ui:fragment rendered="#{field.configField.fieldType == 'input' or field.configField.fieldType == 'generated'}">
                                                                <x:inputText
                                                                    styleClass="form-control"
                                                                    value="#{field.metadata.value}"
                                                                    required="false"
                                                                    id="field_#{status.index}"
                                                                    readonly="#{field.configField.readonly  or field.configField.fieldType == 'generated'}">
                                                                    <f:ajax
                                                                        execute="@this"
                                                                        render="badge-area :header"
                                                                        event="blur"
                                                                        listener="#{NavigationForm.workflowPlugin.entity.updateDisplayName}" />
                                                                </x:inputText>
                                                            </ui:fragment>

                                                            <ui:fragment rendered="#{field.configField.fieldType == 'checkbox'}">
                                                                <h:selectBooleanCheckbox
                                                                    styleClass="form-control checkbox-height-fix"
                                                                    style="width: auto;"
                                                                    value="#{field.booleanValue}">
                                                                    <f:ajax
                                                                        event="change"
                                                                        render="badge-area" />
                                                                </h:selectBooleanCheckbox>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{field.configField.fieldType == 'select'}">
                                                                <h:selectOneMenu
                                                                    styleClass="form-control"
                                                                    value="#{field.metadata.value}">
                                                                    <f:ajax
                                                                        event="change"
                                                                        render="badge-area :header"
                                                                        listener="#{NavigationForm.workflowPlugin.entity.updateDisplayName}" />
                                                                    <f:selectItem
                                                                        itemValue=""
                                                                        itemLabel="#{msgs.bitteAuswaehlen}"
                                                                        itemDisabled="true" />
                                                                    <f:selectItems
                                                                        value="#{field.configField.valueList}"
                                                                        var="item"
                                                                        itemLabel="#{item}"
                                                                        itemValue="#{item}" />
                                                                </h:selectOneMenu>
                                                            </ui:fragment>

                                                            <ui:fragment rendered="#{field.configField.fieldType == 'vocabularyList'}">
                                                                <h:selectOneMenu
                                                                    styleClass="form-control"
                                                                    value="#{field.vocabularyValue}">
                                                                    <f:ajax
                                                                        event="change"
                                                                        render="badge-area :header"
                                                                        listener="#{NavigationForm.workflowPlugin.entity.updateDisplayName}" />
                                                                    <f:selectItem
                                                                        itemValue=""
                                                                        itemLabel="#{msgs.bitteAuswaehlen}"
                                                                        itemDisabled="false" />
                                                                    <f:selectItems
                                                                        value="#{field.configField.vocabularyList}"
                                                                        var="item"
                                                                        itemLabel="#{item}"
                                                                        itemValue="#{item}" />
                                                                </h:selectOneMenu>
                                                            </ui:fragment>

                                                        </h:panelGroup>

                                                        <h:panelGroup
                                                            id="group"
                                                            layout="block"
                                                            rendered="#{field.configField.group}"
                                                            styleClass="col-sm-9">
                                                            <ui:repeat
                                                                var="subfield"
                                                                value="#{field.subfields}">
                                                                <h:panelGroup
                                                                    layout="block"
                                                                    styleClass="group-metadata #{subfield.configField.labelPosition == 'left' ? 'language-field' : ''}"
                                                                    rendered="#{subfield.configField.fieldType != 'language' and subfield.configField.fieldType != 'publish'}">

                                                                    <h:outputText
                                                                        styleClass="field-label"
                                                                        value="#{msgs[subfield.configField.label]}"
                                                                        rendered="#{subfield.configField.fieldType != 'publish' and subfield.configField.labelPosition != 'none'}" />

                                                                    <h:panelGroup
                                                                        rendered="#{subfield.configField.fieldType == 'input' or subfield.configField.fieldType == 'generated'}"
                                                                        id="inputGroup">
                                                                        <x:inputText
                                                                            styleClass="form-control"
                                                                            value="#{subfield.metadata.value}"
                                                                            required="false"
                                                                            validator="#{subfield.requiredValidator}"
                                                                            readonly="#{subfield.configField.readonly  or subfield.configField.fieldType == 'generated'}"
                                                                            id="inputField">
                                                                            <f:ajax
                                                                                execute="@this"
                                                                                render="badge-area :header"
                                                                                event="blur"
                                                                                listener="#{NavigationForm.workflowPlugin.entity.updateDisplayName}" />
                                                                        </x:inputText>
                                                                        <h:panelGroup
                                                                            layout="block"
                                                                            rendered="#{!subfield.valid}"
                                                                            styleClass="font-danger validation-message">
                                                                            <h:outputText value="#{subfield.validationErrorMessage}" />
                                                                        </h:panelGroup>
                                                                    </h:panelGroup>

                                                                    <x:inputTextarea
                                                                        styleClass="form-control"
                                                                        value="#{subfield.metadata.value}"
                                                                        required="false"
                                                                        rendered="#{subfield.configField.fieldType == 'textarea'}"
                                                                        readonly="#{subfield.configField.readonly}">
                                                                        <f:ajax
                                                                            execute="@this"
                                                                            render="badge-area :header"
                                                                            event="blur"
                                                                            listener="#{NavigationForm.workflowPlugin.entity.updateDisplayName}" />
                                                                    </x:inputTextarea>

                                                                    <ui:fragment rendered="#{subfield.configField.fieldType == 'select'}">
                                                                        <h:selectOneMenu
                                                                            styleClass="form-control"
                                                                            value="#{subfield.metadata.value}">
                                                                            <f:ajax
                                                                                event="change"
                                                                                render="badge-area" />
                                                                            <f:selectItem
                                                                                itemValue=""
                                                                                itemLabel="#{msgs.bitteAuswaehlen}"
                                                                                itemDisabled="true" />
                                                                            <f:selectItems
                                                                                value="#{subfield.configField.valueList}"
                                                                                var="item"
                                                                                itemLabel="#{item}"
                                                                                itemValue="#{item}" />
                                                                        </h:selectOneMenu>
                                                                    </ui:fragment>

                                                                    <ui:fragment rendered="#{subfield.configField.fieldType == 'vocabularyList'}">
                                                                        <h:selectOneMenu
                                                                            styleClass="form-control"
                                                                            value="#{subfield.vocabularyValue}">
                                                                            <f:ajax
                                                                                event="change"
                                                                                render="badge-area" />
                                                                            <f:selectItem
                                                                                itemValue=""
                                                                                itemLabel="#{msgs.bitteAuswaehlen}"
                                                                                itemDisabled="false" />
                                                                            <f:selectItems
                                                                                value="#{subfield.configField.vocabularyList}"
                                                                                var="item"
                                                                                itemLabel="#{item}"
                                                                                itemValue="#{item}" />
                                                                        </h:selectOneMenu>
                                                                    </ui:fragment>

                                                                    <ui:fragment rendered="#{subfield.configField.fieldType == 'vocabularySearch'}">
                                                                        <div class="vocabulary-search">
                                                                            <x:inputText
                                                                                styleClass="form-control"
                                                                                value="#{subfield.metadata.value}"
                                                                                required="false"
                                                                                id="field_#{status.index}"
                                                                                readonly="true">
                                                                                <f:ajax
                                                                                    execute="@this"
                                                                                    render="badge-area"
                                                                                    event="blur" />
                                                                            </x:inputText>
                                                                            <span>
                                                                                <button
                                                                                    jsf:id="vocabularySearch"
                                                                                    class="btn change-icon vocabularySearchIndexTrigger btn--icon-light metadataButton pull-right viaf-btn"
                                                                                    title="#{msgs.NORM_vocabularySearch}"
                                                                                    aria-label="#{msgs.NORM_vocabularySearch}"
                                                                                    type="button"
                                                                                    jsf:onclick="$('#vocabularySearchBox').modal('show');">
                                                                                    <img
                                                                                        class="toggle"
                                                                                        style="width: 16px;"
                                                                                        alt="Vocabulary"
                                                                                        src="template/img/Icons_Vocabulary_grey.png" />
                                                                                    <img
                                                                                        class="toggle"
                                                                                        style="width: 16px;"
                                                                                        alt="Vocabulary"
                                                                                        src="template/img/Icons_Vocabulary_color.png" />
                                                                                    <f:setPropertyActionListener
                                                                                        value="#{subfield}"
                                                                                        target="#{NavigationForm.workflowPlugin.searchField}" />
                                                                                    <f:ajax
                                                                                        execute="@this"
                                                                                        render=":vocabularySearchModalContent" />
                                                                                    <f:passThroughAttribute
                                                                                        name="data-toggle"
                                                                                        value="tooltip" />
                                                                                    <f:passThroughAttribute
                                                                                        name="data-placement"
                                                                                        value="top" />
                                                                                </button>
                                                                            </span>
                                                                        </div>
                                                                    </ui:fragment>
                                                                    <ui:fragment rendered="#{subfield.configField.fieldType == 'fileupload'}">

                                                                        <h:inputFile
                                                                            id="thirdtab_fileupload3"
                                                                            value="#{subfield.uploadedFile}"
                                                                            storage="file"
                                                                            styleClass="form-control form-control-file"
                                                                            style="border: 0;padding-left: 0px;"
                                                                            required="false">
                                                                            <f:ajax
                                                                                listener="#{subfield.uploadFile}"
                                                                                render="thirdtab_fileupload3_message" />
                                                                        </h:inputFile>
                                                                    </ui:fragment>
                                                                    <h:panelGroup
                                                                        rendered="#{subfield.configField.fieldType == 'date'}"
                                                                        id="group">
                                                                        <!-- TODO show wrong syntax errors, add date picker  -->
                                                                        <x:inputText
                                                                            styleClass="form-control"
                                                                            value="#{subfield.metadata.value}"
                                                                            required="false"
                                                                            readonly="false"
                                                                            id="dateField"
                                                                            validator="#{subfield.dateValidator}">
                                                                            <f:ajax
                                                                                execute="@this"
                                                                                render="badge-area group"
                                                                                event="blur" />
                                                                        </x:inputText>
                                                                        <h:panelGroup
                                                                            layout="block"
                                                                            rendered="#{!subfield.valid}"
                                                                            styleClass="font-danger validation-message">
                                                                            <h:outputText value="#{subfield.validationErrorMessage}" />
                                                                        </h:panelGroup>
                                                                    </h:panelGroup>

                                                                </h:panelGroup>
                                                            </ui:repeat>
                                                            <ui:include src="includes/sources.xhtml" />
                                                        </h:panelGroup>
                                                    </div>
                                                </ui:repeat>
                                            </ui:repeat>

                                        </div>
                                        <!-- vocabulary search modal -->
                                        <ui:include src="includes/vocabulary_search_modal.xhtml" />

                                        <!-- sources modal -->
                                        <ui:include src="includes/source_modal.xhtml" />
                                    </h:form>
                                </div>
                            </div>
                        </div>





                    <div class="col-sm-12 col-md-6">
                        <h:form>
                            <ui:repeat
                                var="type"
                                value="#{NavigationForm.workflowPlugin.entity.linkedRelationships}">

                                <ui:include src="includes/linked_entities.xhtml" />

                            </ui:repeat>

                        </h:form>
                    </div>

                </div> <!-- end row -->



                <!-- link entity modal -->
                <ui:include src="includes/link_entity_modal.xhtml" />
                <ui:include src="includes/search_entity_modal.xhtml" />
                <h:inputHidden
                    value="#{NavigationForm.workflowPlugin.mainScrollPosition}"
                    id="scrollpos" />

            </div>
            <div class="row editor-actions">
                <h:form styleClass="col-sm-12">

                    <button
                        class="btn btn-green pull-right"
                        jsf:id="save"
                        jsf:action="#{NavigationForm.workflowPlugin.saveEntity}">
                        <i class="fa fa-floppy-o margin-right-5 big-icon" />
                        <h:outputText value="#{msgs.save}" />
                    </button>


                    <button
                        class="btn btn-lightgrey pull-right margin-right-10"
                        jsf:id="exportSingle"
                        jsf:action="#{NavigationForm.workflowPlugin.exportSingleRecord}">
                        <i class="fa fa-globe margin-right-5 big-icon" />
                        <h:outputText value="#{msgs.plugin_workflow_entity_exportSingleRecord}" />
                    </button>

                    <button
                        class="btn btn-lightgrey pull-right margin-right-10"
                        jsf:id="exportAll"
                        jsf:action="#{NavigationForm.workflowPlugin.exportAllRecords}">
                        <i class="fa fa-globe margin-right-5 big-icon" />
                        <h:outputText value="#{msgs.plugin_workflow_entity_exportRecordWithDependencies}" />
                    </button>

                </h:form>
            </div>


            <script type="text/javascript">
                                                    jsf.ajax.addOnEvent( function( data ) {
                                                        var ajaxstatus = data.status;
                                                        switch ( ajaxstatus ) {
                                                            case "begin":
                                                                var scrollPosition = $( '.main-area' ).scrollTop();
                                                                $( '#scrollpos' ).val( scrollPosition );
                                                                break;
                                                            case "success":
                                                                var scrollPosition = $( '#scrollpos' ).val();
                                                                $( '.main-area' ).scrollTop( scrollPosition )
                                                                break;
                                                        }
                                                    } );
                                                </script>

        </main>
    </ui:define>

</ui:composition>
