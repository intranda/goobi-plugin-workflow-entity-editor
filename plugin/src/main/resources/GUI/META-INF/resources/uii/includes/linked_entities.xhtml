<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <div class="col-sm-6 entity-box">
            <div
                class="box  box-bordered"
                style="color: #{type.key.color}">
                <div
                    class="box-title"
                    jsf:style="border-color: #{type.key.color}">
                    <h3>
                        <i class="fa #{type.key.icon} big-icon" />
                        <h:outputFormat value="#{msgs.plugin_workflow_entity_link_header}">
                            <f:param value="#{type.key.plural}" />

                            <f:param value="#{type.value.size()}" />
                        </h:outputFormat>

                    </h3>

                    <div class="box-title__actions">


                    <button
                        class="btn nobackground"
                        jsf:id="addRelationship"
                        style="color:  #{type.key.color}; margin-right: 5px;"
                        jsf:action="#{NavigationForm.workflowPlugin.addRelationship(type.key)}"
                        jsf:onclick="$('#entitySearchBox').modal('show');">
                        <!--                         <i class="fa fa-chain big-icon" /> -->
                        <i class="fa fa-plus big-icon" />
                        <f:ajax
                            execute="@this"
                            render=":entityModalContent" />
                    </button>

                    <h:panelGroup rendered="#{ type.value.size() != 0 }">
                    <button
                        class="btn nobackground"
                        jsf:id="showContent"
                        style="color:  #{type.key.color}; margin-right: 5px;">

                        <f:setPropertyActionListener
                            value="#{not type.key.showLinkedContent}"
                            target="#{type.key.showLinkedContent}" />
                        <i class="fa #{type.key.showLinkedContent ? 'fa-angle-down' : 'fa-angle-up'} big-icon" />
                        <f:ajax
                            execute="@this"
                            render="@form" />
                    </button>
                    </h:panelGroup>


                    </div>


                </div>
                <h:panelGroup
                    layout="block"
                    styleClass="box-content nopadding #{type.key.name}"
                    style="border-color: #{type.key.color}; #{type.key.showLinkedContent ? '' : 'display:none'}"
                    id="sources"
                    rendered="#{ type.value.size() != 0 }">

                    <h:panelGroup
                        styleClass="relation-row header"
                        rendered="#{type.key.showLinkedContent}">

                        <div></div>
                        <div>#{msgs.plugin_workflow_entity_sourceName}</div>
                        <div>#{msgs.plugin_workflow_entity_sourceStatus}</div>
                        <div>#{msgs.plugin_workflow_entity_sourceAction}</div>

                    </h:panelGroup>
                    <h:panelGroup
                        layout="block"
                        styleClass="sources"
                        rendered="#{type.key.showLinkedContent}">
                        <ui:repeat
                            var="relationship"
                            value="#{type.value}">





                            <h:panelGroup
                                styleClass="relation-row"
                                id="entity">


                                <button
                                    jsf:id="toggleSourceVisibility"
                                    class="btn btn--icon-light source-btn nobackground">
                                    <i
                                        class="fa #{relationship.showDetails == false?'fa fa-chevron-down':'fa fa-chevron-up'}"
                                        style="color: #{type.key.color};" />
                                    <f:ajax
                                        execute="entity"
                                        render="entity" />
                                    <f:setPropertyActionListener
                                        value="#{not relationship.showDetails}"
                                        target="#{relationship.showDetails}" />
                                </button>

                                <div>
                                    <h:outputText
                                        value="#{relationship.displayName}"
                                        style="color: #333" />
                                </div>
                                <div>
                                    <h:outputText
                                        value="#{relationship.processStatus}"
                                        styleClass="badge-bordered" />
                                </div>
                                <div>
                                    <button
                                        class="btn nobackground"
                                        jsf:id="removeRelationship"
                                        style="color:  #{type.key.color};"
                                        jsf:action="#{NavigationForm.workflowPlugin.removeRelationship(type.key, relationship)}">
                                        <i class="fa fa-chain-broken" />
                                        <f:ajax
                                            execute="@form"
                                            render="@form" />
                                    </button>

                                    <button
                                        class="btn btn-mini"
                                        jsf:id="editRelationship"
                                        style="background-color: #{type.key.color}; color: #fff; margin-left: 5px;"
                                        jsf:action="#{NavigationForm.workflowPlugin.editRelationship(relationship)}">
                                        <i class="fa fa-pencil" />
                                    </button>

                                </div>

                                <ui:fragment rendered="#{relationship.showDetails}">
                                    <div style="grid-column-start: 1; grid-column-end: 5;">
                                        <h:panelGroup
                                            layout="block"
                                            styleClass="row"
                                            style="padding-left: 20px; width: 80%;"
                                            rendered="#{relationship.type != null}">
                                            <div class="col-sm-4">
                                                <h:outputText
                                                    value="#{msgs.plugin_workflow_entity_editor_type}"
                                                    style="color: #333" />
                                            </div>
                                            <div class="col-sm-8">
                                                <h:outputText
                                                    value="#{relationship.type}"
                                                    style="color: #333" />
                                            </div>
                                        </h:panelGroup>
                                        <h:panelGroup
                                            layout="block"
                                            styleClass="row"
                                            style="padding-left: 20px; width: 80%;"
                                            rendered="#{relationship.beginningDate != null}">
                                            <div class="col-sm-4">
                                                <h:outputText
                                                    value="#{msgs.plugin_workflow_entity_editor_beginnDate}"
                                                    rendered="#{relationship.beginningDate != null}"
                                                    style="color: #333" />
                                            </div>

                                            <div class="col-sm-8">
                                                <h:outputText
                                                    value="#{relationship.beginningDate}"
                                                    rendered="#{relationship.beginningDate != null}"
                                                    style="color: #333" />
                                            </div>

                                        </h:panelGroup>
                                        <h:panelGroup
                                            layout="block"
                                            styleClass="row"
                                            style="padding-left: 20px; width: 80%;"
                                            rendered="#{relationship.endDate != null}">
                                            <div class="col-sm-4">
                                                <h:outputText
                                                    value="#{msgs.plugin_workflow_entity_editor_endDate}"
                                                    rendered="#{relationship.endDate != null}"
                                                    style="color: #333" />
                                            </div>
                                            <div class="col-sm-8">
                                                <h:outputText
                                                    value="#{relationship.endDate}"
                                                    rendered="#{relationship.endDate != null}"
                                                    style="color: #333" />
                                            </div>
                                        </h:panelGroup>
                                        <h:panelGroup
                                            layout="block"
                                            styleClass="row"
                                            style="padding-left: 20px; width: 80%;"
                                            rendered="#{relationship.additionalData != null}">
                                            <div class="col-sm-4">
                                                <h:outputText
                                                    value="#{msgs.plugin_workflow_entity_editor_additionalData}"
                                                    rendered="#{relationship.additionalData != null}"
                                                    style="color: #333" />
                                            </div>
                                            <div class="col-sm-8">
                                                <h:outputText
                                                    value="#{relationship.additionalData}"
                                                    rendered="#{relationship.additionalData != null}"
                                                    style="color: #333" />
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                </ui:fragment>
                            </h:panelGroup>
                        </ui:repeat>
                    </h:panelGroup>

                </h:panelGroup>
            </div>
        </div>

    </composite:implementation>
</ui:composition>
